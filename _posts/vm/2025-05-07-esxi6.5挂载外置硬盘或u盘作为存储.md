---
title: "esxi6.5挂载外置硬盘或u盘作为存储"
tags: vm
---



1. 进入ESXi单节点控制台开启ssh
2. 使用xshell或secureCRT等终端工具远程进入系统中。
   在不接入移动硬盘或U盘的情况下输入一下指令
   关闭usbarbitrator服务

```bash
/etc/init.d/usbarbitrator stop
```

1. 关闭usbarbitrator服务开机自启

```bash
chkconfig usbarbitrator off
```

1. 接入你的USB硬盘，查找usb存储设备，这时我们可以看到（Is USB:true）说明我们的usb硬盘已经被识别出来

```bash
esxcli storage core device list |grep -I usb
```

![图2](./2025-05-07-esxi6.5挂载外置硬盘或u盘作为存储.assets/e93295908abce289344c44978b5f180d.png)

1. 输入以下命令，列出我们USB硬盘的信息,显示为（t10.000000000000000000000000000000000000000000000000000000000000000000000000NA8ZY9H0）这里的信息每个人的都不一样

```bash
ls /dev/disks/
```

![图3](./2025-05-07-esxi6.5挂载外置硬盘或u盘作为存储.assets/03f6ef1aac002d54877b5f17b25d5416.png)

1. 我们对移动存储设备进行采用gpt分区格式进行分区（格式分区会将设备进行格式化，建议使用没有重要数据的硬盘或者空盘来进行操作）

```bash
partedUtil mklabel /dev/disks/t10.000000000000000000000000000000000000000000000000000000000000000000000000NA8ZY9H0 gpt
```

1. 然后查看设置为gpt分区格式后的磁盘信息

```bash
partedUtil getptbl /dev/disks/t10.000000000000000000000000000000000000000000000000000000000000000000000000NA8ZY9H0
```

![图4](./2025-05-07-esxi6.5挂载外置硬盘或u盘作为存储.assets/d0e687812b44144801c4627ceedd8504.png)

1. 接下来换算硬盘的二进制数值
   通过两种方式：
   第一种手动计算：用获得的gpt的3个值进行计算。公示为前三个数值相乘然后减1的到的结果，例如我的gpt格式下的值为486401 255 63
   换算成硬盘的二进制数值为486401*255*63-1=7814032064，做下记录，下面会用到。
   第二种方式通过命令行计算获得：

```bash
eval expr $(partedUtil getptbl /dev/disks/t10.000000000000000000000000000000000000000000000000000000000000000000000000NA8ZY9H0 | tail -1 | awk '{print $1 " \\* " $2 " \\* " $3
}') - 1
```

1. 磁盘名称更换成自己的名称再计算
   得到的结果也为
   7814032064
   ![图5](./2025-05-07-esxi6.5挂载外置硬盘或u盘作为存储.assets/c06bfb3cc6be6fc07595743661158e67.png)
2. 下面在输入以下命令并修改为自己的硬盘数值来对硬盘进行分区，修改为你上一步换算出来的数值(7814032064)

```bash
partedUtil setptbl /dev/disks/t10.000000000000000000000000000000000000000000000000000000000000000000000000NA8ZY9H0 gpt "1 2048 7814032064 AA31E02A400F11DB9590000C2911D1B8 0"
```

![图6](./2025-05-07-esxi6.5挂载外置硬盘或u盘作为存储.assets/a3e9245066d2136a7eecb82f549d1895.png)

1. 其中AA31E02A400F11DB9590000C2911D1B8此值为ESXi6.5的固定值，其他版本需要先查看默认的系统磁盘分区的值。由下图可以看到在ESXi6.5中的系统分区的都是此值。
   ![图7](./2025-05-07-esxi6.5挂载外置硬盘或u盘作为存储.assets/00d5456e37bc94c922a8f5b57a468407.png)
2. 载我们USB硬盘,注意这里，不仅要换为你硬盘的数值，并且还要在后面加上分区号。

```bash
vmkfstools -C vmfs5 -S USB_Datastore /dev/disks/t10.000000000000000000000000000000000000000000000000000000000000000000000000NA8ZY9H0:1
```

![图8](./2025-05-07-esxi6.5挂载外置硬盘或u盘作为存储.assets/9eb219778cf890195edb0ce88fa33e04.png)

1. 看到successfully说明已经挂在成功了，然后到此节点的控制台中打开存储可以看到已经将usb的存储设备添加到存储列表中了
   ![图9](./2025-05-07-esxi6.5挂载外置硬盘或u盘作为存储.assets/bbe5b25ba4e0a5ea2520de4667c27c52.png)